<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Hint App</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>

  <div class="container">
    <h1>Manage Hints</h1>

    <!-- Dropdown for selecting actions -->
    <div class="dropdown">
      <select id="action-select" onchange="handleActionChange()">
        <option value="">Select Action</option>
        <option value="create">Create Hint</option>
        <option value="edit">Edit Hint</option>
        <option value="delete">Delete Hint</option>
      </select>
    </div>

    <!-- Create/Edit Form (Visible based on dropdown selection) -->
    <div id="create-form" style="display: none;">
      <input id="create-hint" placeholder="Enter a hint..." />
      <input id="create-msg" placeholder="Enter a message..." />
      <button onclick="createHint()">Save Hint</button>
      <button id="edit-btn" onclick="editHint()" style="display:none;">Edit Hint</button>
      <button id="delete-btn" onclick="deleteHint()" style="display:none;">Delete Hint</button>
      <p id="create-status"></p>
    </div>

    <!-- Progress bar -->
    <div id="progress-bar" style="display:none;">
      <div id="progress" style="height: 4px; width: 0%; background-color: #00ff00;"></div>
    </div>

    <!-- Hints List -->
    <div id="hint-list">
      <h2>Available Hints</h2>
      <div id="hints"></div>
    </div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-app.js";
    import { getFirestore, collection, addDoc, doc, getDoc, deleteDoc, getDocs, setDoc } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyD4BMJXDCPb0YD4enpmV_xOPMFi6WtffxY",
      authDomain: "hint-9661b.firebaseapp.com",
      projectId: "hint-9661b",
      storageBucket: "hint-9661b.firebasestorage.app",
      messagingSenderId: "667786662167",
      appId: "1:667786662167:web:31a8ac0a7ffc3b30586752",
      measurementId: "G-S8BYZRVEWW"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    let currentHintId = null;

    window.createHint = async function () {
      const hint = document.getElementById("create-hint").value.trim();
      const message = document.getElementById("create-msg").value.trim();
      const status = document.getElementById("create-status");

      if (!hint || !message) {
        status.textContent = "Please fill out both fields.";
        return;
      }

      try {
        // Show progress bar while saving
        document.getElementById("progress-bar").style.display = "block";
        let progress = 0;
        const interval = setInterval(() => {
          if (progress < 100) {
            progress += 10;
            document.getElementById("progress").style.width = `${progress}%`;
          } else {
            clearInterval(interval);
          }
        }, 200);

        if (currentHintId) {
          // Edit existing hint
          const hintRef = doc(db, "hints", currentHintId);
          await setDoc(hintRef, { hint, message });
          status.textContent = "✅ Hint updated!";
        } else {
          // Create new hint
          await addDoc(collection(db, "hints"), { hint, message });
          status.textContent = "✅ Hint saved!";
        }
        resetForm();
        updateHintList(); // Update the hint list after creating/editing
      } catch (error) {
        console.error(error);
        status.textContent = "❌ Error saving hint.";
      }
    };

    window.fetchHint = async function (id) {
      const hintRef = doc(db, "hints", id);
      const docSnap = await getDoc(hintRef);
      
      if (docSnap.exists()) {
        const data = docSnap.data();
        document.getElementById("create-hint").value = data.hint;
        document.getElementById("create-msg").value = data.message;
        currentHintId = id;
        document.getElementById("edit-btn").style.display = "inline-block";
        document.getElementById("delete-btn").style.display = "inline-block";
      } else {
        console.log("No such document!");
      }
    };

    window.deleteHint = async function () {
      const hintRef = doc(db, "hints", currentHintId);
      try {
        await deleteDoc(hintRef);
        document.getElementById("create-status").textContent = "✅ Hint deleted!";
        resetForm();
        updateHintList(); // Update the hint list after deletion
      } catch (error) {
        console.error(error);
        document.getElementById("create-status").textContent = "❌ Error deleting hint.";
      }
    };

    window.updateHintList = async function() {
      const querySnapshot = await getDocs(collection(db, "hints"));
      const hintsDiv = document.getElementById("hints");
      hintsDiv.innerHTML = ""; // Clear the list before updating
      querySnapshot.forEach((doc) => {
        const hintData = doc.data();
        const hintElement = document.createElement("div");
        hintElement.className = "hint";
        hintElement.innerHTML = `<strong>${hintData.hint}</strong>: ${hintData.message}<button onclick="fetchHint('${doc.id}')">Edit</button>`;
        hintsDiv.appendChild(hintElement);
      });
    };

    function resetForm() {
      currentHintId = null;
      document.getElementById("create-hint").value = "";
      document.getElementById("create-msg").value = "";
      document.getElementById("edit-btn").style.display = "none";
      document.getElementById("delete-btn").style.display = "none";
      document.getElementById("progress-bar").style.display = "none";
      document.getElementById("action-select").value = ""; // Reset the dropdown
    }

    window.handleActionChange = function() {
      const action = document.getElementById("action-select").value;
      const createForm = document.getElementById("create-form");

      if (action === "create") {
        createForm.style.display = "block";
        resetForm();
      } else if (action === "edit") {
        createForm.style.display = "block";
      } else if (action === "delete") {
        createForm.style.display = "none";
      } else {
        createForm.style.display = "none";
      }
    };

    // Fetch and display all hints on load
    window.onload = async function() {
      await updateHintList();
    };
  </script>
</body>
</html>
